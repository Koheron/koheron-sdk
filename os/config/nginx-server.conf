server {
    listen                      80;
    server_name                 localhost;

    location / {
        root                    /tmp/live-instrument;
        index                   index.html;

        # http://serverfault.com/questions/269420/disable-caching-when-serving-static-files-with-nginx-for-development
        expires                 0;
        add_header              Cache-Control private;
    }

    location /koheron {
        alias                   /usr/local/www;
        index                   index.html;
    }

    location /run {
        alias                   /run/koheron;
    }

    location /api {
        uwsgi_pass unix:/run/uwsgi/app.sock;
        include /etc/nginx/uwsgi_params;

        # If responses can be big or bursty, tune these (uwsgi_* not proxy_*)
        uwsgi_buffering on;
        uwsgi_buffers 8 64k;          # adjust per workload
        uwsgi_busy_buffers_size 128k;
        uwsgi_buffer_size 64k;

        uwsgi_read_timeout 60s;       # only if your handlers need it
    }

    location /koheron-server {
        proxy_pass         http://127.0.0.1:8080;
        proxy_http_version 1.1;

        # WebSocket upgrade
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;

        # Lower latency for streaming/WS
        proxy_buffering off;
        proxy_read_timeout  1d;  # avoid idle WS disconnects
        proxy_send_timeout  1d;

        # Forward client IP (handy for logs/ACLs)
        proxy_set_header X-Real-IP       $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
